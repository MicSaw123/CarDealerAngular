<div class="container">
  <app-header-component/>
    <form [formGroup]="updateListingForm">
      <div class="row justify-content-between">
        <div class="col-xs-12 col-lg-2">
          <label>Title:</label>
          <input [(ngModel)]="listing.Title" type="text" class="input-group-text w-100" id="title"
                 formControlName="title">
          <label>{{listing.Title}}</label>
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Condition:</label>
          <select class="form-select" [(ngModel)]="listing.ListedCar.CarConditionId"
                  formControlName="condition">
            <option *ngFor="let carCondition of basicProperties?.CarCondition" id="carCondition"
                    [value]="carCondition.Id" [disabled]="carCondition.Id === 1">
              {{carCondition.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Production date:</label>
          <input readonly [(ngModel)]="listing.IdentifiedVehicles.ProductionDate"
                 type="date" class="input-group-text w-100"
                 id="productionDate" formControlName="productionDate">
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Mileage:</label>
          <input [(ngModel)]="listing.ListedCar.Mileage" type="text"
                 class="input-group-text w-100" id="mileage" formControlName="mileage">
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Country of origin:</label>
          <select class="form-select"  formControlName="countryOfOrigin"
                  [(ngModel)]="listing.IdentifiedVehicles.CountryOfOriginId">
            <option id="countryOfOrigin"
                    [attr.value]="listing.IdentifiedVehicles.CountryOfOriginId" [attr.selected]="listing.IdentifiedVehicles.CountryOfOriginId">
              {{listing.IdentifiedVehicles.CountryOfOrigin.Name}}
            </option>
          </select>
          <label>{{listing.IdentifiedVehicles.CountryOfOriginId}}</label>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-lg-4">
          <label>VIN:</label>
          <input readonly [(ngModel)]="listing.IdentifiedVehicles.Vin"
                 type="text" class="input-group-text" formControlName="vin" id="vin" style="width: 100%">
        </div>
        <div class="col-xs-12 col-lg-4">
          <label>First registration date:</label>
          <input readonly [(ngModel)]="listing.IdentifiedVehicles.FirstRegistrationDate" type="date"
                 class="input-group-text w-100" id="firstRegistrationDate" formControlName="firstRegistrationDate">
        </div>
        <div class="col-xs-12 col-lg-4">
          <label>License plate:</label>
          <input [(ngModel)]="listing.ListedCar.LicensePlate" type="text" class="input-group-text w-100" id="licensePlate"
                 formControlName="licensePlate">
        </div>
      </div>
      <hr>
      <div class="row justify-content-between">
        <div class="col-xs-12 col-lg-2">
          <label>Manufacturer:</label>
          <select class="form-select"
                  formControlName="manufacturer"
                  [(ngModel)]="listing.ListedCar.ListedCarSpecification.Generation.Model.Manufacturer.Id">
            <option hidden value="" selected disabled>Manufacturer</option>
            <option *ngFor="let manufacturer of basicProperties?.Manufacturer"
                    [attr.value]="manufacturer.Id"
                    id="manufacturer"
            >
              {{manufacturer.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-2" >
          <label>Model:</label>
          <select formControlName="model" class="form-select"
                  [(ngModel)]="listing.ListedCar.ListedCarSpecification.Generation.ModelId">
            <option hidden="hidden" selected >Model</option>
            <option id="model"
                    [attr.value]="listing.ListedCar.ListedCarSpecification.Generation.ModelId"
                    [attr.selected]="listing.ListedCar.ListedCarSpecification.Generation.ModelId"
            >
              {{ listing.ListedCar.ListedCarSpecification.Generation.Model.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Generation:</label>
          <select formControlName="generation" class="form-select" [attr.disabled]="listing.ListedCar.ListedCarSpecification.GenerationId != 0"
                  [(ngModel)]="listingToUpdate.ListedCar.ListedCarSpecification.GenerationId">
            <option id="generation"
                    [attr.value]="listing.ListedCar.ListedCarSpecification.Generation.Id"
                    [attr.selected]="listing.ListedCar.ListedCarSpecification.Generation.Id">
              {{listing.ListedCar.ListedCarSpecification.Generation.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Chassis:</label>
          <select class="form-select"
                  [(ngModel)]="listingToUpdate.ListedCar.ListedCarSpecification.CarTypeId"
                  [attr.disabled]="listing.ListedCar.ListedCarSpecification.CarTypeId != 0"
                  formControlName="carType"
          >
            <option *ngFor="let carType of basicProperties?.CarType"
                    [attr.value]="carType.Id"
                    [attr.selected]="carType.Id === listing.ListedCar.ListedCarSpecification.CarTypeId ? true : null"
                    id="carType">
              {{carType.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Color:</label>
          <select formControlName="carColor" class="form-select" [(ngModel)]="listingToUpdate.ListedCar.CarColorId">
            <option *ngFor="let carColor of basicProperties?.CarColor"
                    id="carColor" [attr.value]="carColor.Id" [attr.selected]="carColor.Id === listing.ListedCar.CarColorId ? true : null">
              {{carColor.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-2">
          <label>Door quantity:</label>
          <select formControlName="doorQuantity" class="form-select" [(ngModel)]="listingToUpdate.ListedCar.ListedCarSpecification.DoorQuantityId"
                  [attr.disabled]="listing.ListedCar.ListedCarSpecification.DoorQuantityId != 0">
            <option *ngFor="let doorQuantity of basicProperties?.DoorQuantity" id="doorQuantity" [attr.value]="doorQuantity.Id"
                    [attr.selected]="doorQuantity.Id === listing.ListedCar.ListedCarSpecification.DoorQuantityId ? true : null">
              {{doorQuantity.Doors}}
            </option>
          </select>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-lg-3">
          <label>Fuel:</label>
          <select class="form-select" formControlName="fuelType">
<!--            <option *ngFor="let fuelType of basicProperties?.FuelType"
                    id="fuelType"
                    [attr.value]="fuelType.Id"
                    [attr.selected]="fuelType.Id === listing.ListedCar.ListedCarSpecification.Engine.FuelTypeId ? true : null"
            >
              {{fuelType.Name}}
            </option>-->
          </select>
        </div>
        <div class="col-xs-12 col-lg-3">
          <label>Engine:</label>
          <select class="form-select"
                  formControlName="engine" [attr.disabled]="listing.ListedCar.ListedCarSpecification.EngineId != 0"
                  [(ngModel)]="listingToUpdate.ListedCar.ListedCarSpecification.EngineId">
            <option [attr.value]="listing.ListedCar.ListedCarSpecification.EngineId"
                    [attr.selected]="listing.ListedCar.ListedCarSpecification.EngineId"
                    id="engine">
              {{listing.ListedCar.ListedCarSpecification.Engine.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-3">
          <label>Transmission type:</label>
          <select class="form-select" formControlName="transmission" [(ngModel)]="listingToUpdate.ListedCar.ListedCarSpecification.TransmissionId"
                  [attr.disabled]="listing.ListedCar.ListedCarSpecification.TransmissionId != 0">
            <option *ngFor="let transmission of basicProperties?.Transmission"
                    id="transmission"
                    [attr.value]="transmission.Id"
                    [attr.selected]="transmission.Id === listing.ListedCar.ListedCarSpecification.TransmissionId ? true : null">
              {{transmission.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-3">
          <label>Drivetrain:</label>
          <select class="form-select" formControlName="drivetrain" [(ngModel)]="listing.ListedCar.ListedCarSpecification.DrivetrainId"
                  [value]="listingToUpdate.ListedCar.ListedCarSpecification.DrivetrainId">
            <option hidden value="" selected disabled></option>
            <option *ngFor="let drivetrain of basicProperties?.Drivetrain"
                    id="drivetrain"
                    [attr.value]="drivetrain.Id"
                    [attr.selected]="drivetrain.Id === listing.ListedCar.ListedCarSpecification.DrivetrainId ? true : null"
            >
              {{drivetrain.Name}}
            </option>
          </select>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-lg-3">
          <label>Previously damaged:</label>
          <select class="form-select" id="damageHistory" [(ngModel)]="listingToUpdate.IdentifiedVehicles.PreviouslyDamagedId"
                  formControlName="previouslyDamaged">
            <option [attr.value]="listing.IdentifiedVehicles.PreviouslyDamagedId"
                    [attr.selected]="listing.IdentifiedVehicles.PreviouslyDamagedId" id="previouslyDamaged">
              {{listing.IdentifiedVehicles.PreviouslyDamaged.Name}}
            </option>
          </select>
        </div>
        <div class="col-xs-12 col-lg-3">
          <label>Previous owners:</label>
          <input readonly [(ngModel)]="listing.ListedCar.PreviousOwners"
                 type="number" class="input-group-text w-100" id="previousOwners" formControlName="previousOwners">
        </div>
        <div class="col-xs-12 col-lg-6">
          <label>Images:</label>
          <input formControlName="images" type="file" accept="image/jpeg, image/png" multiple class="form-control"
                 (change)="onFileSelect($event)" style="height: 60%"/>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-lg-6">
          <div class="row">
            <div class="container">
              <label>Description:</label>
              <textarea [(ngModel)]="listing.Description" class="form-control" style="height: 400px"
                        id="description" formControlName="description"></textarea>
            </div>
          </div>
        </div>
        <div class="col-xs-12 col-lg-6">
          <label>Preview images:</label>
            <div id="carouselExampleIndicators" class="carousel slide">
              <div class="carousel-inner">
                <div *ngFor="let image of listing.Images; index as i">
                  <div [ngClass]="i === 0 ? 'carousel-item active' : 'carousel-item'">
                    <img [src]="'data:image/jpeg;base64,' + image.Image" class="d-block w-100" alt="Slide" style="height: 400px">
                  </div>
                </div>
                <div *ngFor="let image of images">
                  <div class="carousel-item">
                    <img [src]="getImageUrl(image)" class="d-block w-100" alt="Slide" style="height: 400px">
                  </div>
                </div>
                <button [disabled]="isDisabled" (click)="onImageBackwards()" class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button [disabled]="isDisabled" (click)="onImageForward()" class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
            </div>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-lg-6">
          <button type="button" class="btn btn-primary w-100" (click)="updateListing()">
            Update listing
          </button>
        </div>
        <div class="col-xs-12 col-lg-6">
          <button type="button" class="btn btn-danger w-100" (click)="deleteImage(imageName)">
            Delete image
          </button>
        </div>
      </div>
    </form>
</div>
